# 1.1.2 Node.js 版本发布策略与演进逻辑

## 1. 概述

Node.js 采用语义化版本（Semantic Versioning, SemVer）控制，并拥有一套严格的长期支持（Long Term Support, LTS）计划。这种策略确保了企业级应用的稳定性，同时允许快速迭代新特性。

## 2. 特性

- **SemVer 规范**：主版本号（Major）代表重大变更，次版本号（Minor）代表功能新增，修订号（Patch）代表缺陷修复。
- **LTS 机制**：偶数版本（如 20, 22）进入长期支持期，通常获得 3 年的维护保证。
- **Current 分支**：奇数版本（如 21, 23）作为新特性的实验场，生命周期短。
- **实验性 API**：新功能通常以 `Experimental` 标记引入，允许开发者提前测试。

## 3. 版本检查方法

开发者可以使用命令行工具或内置模块获取版本信息。

| 命令/代码             | 功能描述                                         |
|:----------------------|:-------------------------------------------------|
| `node -v`             | 获取当前二进制文件的完整版本号。                 |
| `process.version`     | 在 JS 代码中获取当前运行时版本。                 |
| `process.versions`    | 获取 V8, OpenSSL, Zlib 等底层依赖的版本集合。    |

## 4. 参数说明

在某些环境下，可以通过参数控制对实验性版本的访问。

| 参数                  | 类型     | 说明                                             |
|:----------------------|:---------|:-------------------------------------------------|
| `--no-warnings`       | Boolean  | 隐藏使用实验性 API 时出现的警告提示。            |
| `--experimental-esm`  | Boolean  | 在旧版本中显式启用 ESM 支持（现已默认开启）。   |

## 5. 返回值与输出

版本信息通常以字符串形式返回。

| 返回属性              | 示例值   | 说明                                             |
|:----------------------|:---------|:-------------------------------------------------|
| `node`                | `v22.5.1`| Node.js 运行时的主版本信息。                     |
| `v8`                  | `12.4.x` | 当前 Node.js 绑定的 V8 引擎版本。                |

## 6. 代码示例

以下代码展示了如何根据运行时版本执行不同的兼容性逻辑。

```ts
// 文件: version-logic.ts
// 功能: 演示版本检测与条件执行

import { version, versions } from 'node:process';

console.log(`当前 Node.js 版本: ${version}`);

// 检查是否满足 Node.js 22+ 的要求
const majorVersion = parseInt(version.slice(1).split('.')[0]);

if (majorVersion >= 22) {
  console.log('检测到当前为 LTS 版本 22+，可以使用最新特性。');
} else {
  console.warn('警告: 当前版本较低，部分 ESM 特性可能受限。');
}

console.log('底层依赖详情:', versions);
```

## 7. 输出结果说明

```text
当前 Node.js 版本: v22.12.0
检测到当前为 LTS 版本 22+，可以使用最新特性。
底层依赖详情: { node: '22.12.0', v8: '12.4.254.21-node.17', ... }
```

## 8. 注意事项

- **生产环境选型**：生产环境务必选择偶数号的 LTS 版本，严禁在生产中使用 Odd-numbered（奇数）版本。
- **API 弃用计划**：注意控制台出现的 `DeprecationWarning`，它们通常预示着该 API 将在下一个主版本中移除。

## 9. 常见问题 (FAQ)

**Q: 为什么 odd 编号的版本生命周期这么短？**
A: 奇数版本是为了快速测试和收集反馈。如果新特性在奇数版本中被证明是成功的，它们会被合入到下一个偶数 LTS 版本中。

**Q: 如何在同一台机器上快速切换版本？**
A: 推荐使用 `fnm` (Fast Node Manager) 或 `nvm`，这将在后续章节详细介绍。

## 10. 最佳实践

- **.node-version 文件**：在项目根目录放置此文件，记录项目所需的具体版本号。
- **CI/CD 对齐**：确保你的 CI 流程中使用的 Node.js 版本与本地开发、线上运行环境完全一致。

## 11. 版本对比

| 版本类型     | 维护时长 | 稳定性   | 适用场景                                         |
|:-------------|:---------|:---------|:-------------------------------------------------|
| **Current**  | ~6 个月  | 较低     | 尝鲜新特性、开源库兼容性测试。                   |
| **Active LTS**| ~12 个月 | 极高     | 生产环境部署、核心业务系统。                     |
| **Security** | ~18 个月 | 极高     | 旧项目维护期，仅修复安全漏洞。                   |

## 12. 练习任务

1. **环境检查**：运行 `node -p "process.versions.v8"`，查看你当前使用的 V8 引擎版本。
2. **逻辑编写**：编写一个脚本，如果当前版本低于 v20，则通过 `process.exit(1)` 强行终止程序。
3. **文档查阅**：访问 Node.js 官网，查找当前最新的 LTS 版本号及其维护截止日期。
