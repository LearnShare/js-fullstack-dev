# 5.1.3 索引设计

## 1. 概述

索引是提高数据库查询性能的重要机制，通过索引可以快速定位数据。合理的索引设计可以显著提高查询性能，但不合理的索引设计会影响写入性能。

## 2. 索引类型

### 2.1 B-Tree 索引

**特点**：
- 最常用的索引类型
- 支持范围查询
- 支持排序
- 适用于等值查询和范围查询

**使用场景**：
- 主键索引
- 唯一索引
- 普通索引

### 2.2 哈希索引

**特点**：
- 只支持等值查询
- 不支持范围查询
- 查询速度快
- 内存索引

**使用场景**：
- 等值查询频繁
- 不需要范围查询
- 内存数据库

### 2.3 全文索引

**特点**：
- 支持全文搜索
- 支持模糊匹配
- 适用于文本搜索

**使用场景**：
- 文本搜索
- 内容检索
- 搜索引擎

## 3. 索引设计原则

### 3.1 选择性原则

- **高选择性**：索引字段值分布均匀
- **低选择性**：索引字段值重复度高
- **选择合适字段**：选择选择性高的字段

### 3.2 覆盖索引

**定义**：索引包含查询所需的所有字段

**优势**：
- 避免回表查询
- 提高查询性能
- 减少 I/O 操作

**示例**：
```sql
-- 查询只需要 id 和 name
CREATE INDEX idx_user_name ON users(name);

-- 覆盖索引：包含查询所需字段
CREATE INDEX idx_user_cover ON users(name, email);
```

### 3.3 复合索引

**定义**：多个字段组合的索引

**原则**：
- 最左前缀原则
- 选择性高的字段在前
- 考虑查询模式

**示例**：
```sql
-- 复合索引
CREATE INDEX idx_user_name_email ON users(name, email);

-- 可以使用索引的查询
SELECT * FROM users WHERE name = 'John';
SELECT * FROM users WHERE name = 'John' AND email = 'john@example.com';

-- 不能使用索引的查询
SELECT * FROM users WHERE email = 'john@example.com';
```

## 4. 索引使用场景

### 4.1 应该创建索引

- 主键字段
- 外键字段
- 频繁查询的字段
- 排序和分组字段
- WHERE 子句中的字段

### 4.2 不应该创建索引

- 很少查询的字段
- 更新频繁的字段
- 数据量小的表
- 选择性很低的字段

## 5. 索引维护

### 5.1 索引重建

```sql
-- PostgreSQL
REINDEX INDEX idx_user_name;

-- MySQL
ALTER TABLE users DROP INDEX idx_user_name;
CREATE INDEX idx_user_name ON users(name);
```

### 5.2 索引分析

```sql
-- PostgreSQL：分析索引使用情况
SELECT * FROM pg_stat_user_indexes;

-- MySQL：查看索引使用情况
SHOW INDEX FROM users;
```

## 6. 最佳实践

### 6.1 索引设计

- 根据查询模式设计索引
- 避免过多索引
- 定期审查索引使用情况
- 优化索引顺序

### 6.2 性能优化

- 使用覆盖索引
- 优化复合索引顺序
- 定期重建索引
- 监控索引性能

## 7. 注意事项

- **写入性能**：索引会影响写入性能
- **存储空间**：索引占用存储空间
- **维护成本**：索引需要维护
- **查询优化**：合理使用索引

## 8. 常见问题

### 8.1 如何选择索引字段？

选择查询频繁、选择性高的字段，考虑查询模式。

### 8.2 复合索引的顺序如何确定？

根据查询模式和使用频率确定，遵循最左前缀原则。

### 8.3 如何优化索引性能？

使用覆盖索引，优化索引顺序，定期重建索引。

## 9. 实践任务

1. **创建索引**：为常用查询创建合适的索引
2. **优化索引**：优化现有索引设计
3. **分析索引**：分析索引使用情况和性能
4. **维护索引**：定期维护和重建索引
5. **性能测试**：测试索引对查询性能的影响

---

**下一章**：[5.2 关系型数据库（SQL）](../chapter-02-sql/readme.md)
