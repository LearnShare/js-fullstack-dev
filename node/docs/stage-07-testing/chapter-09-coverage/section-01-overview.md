# 7.9.1 代码覆盖率概述

## 1. 概述

代码覆盖率是衡量测试覆盖了多少代码的指标，包括语句覆盖率、分支覆盖率、函数覆盖率和行覆盖率。深入理解代码覆盖率有助于提高测试质量。

## 2. 覆盖率类型详解

### 2.1 语句覆盖率

**定义**：执行了多少条语句。

**计算**：`执行的语句数 / 总语句数`

**示例**：
```ts
function example(a: number, b: number): number {
  if (a > 0) {
    return a + b;  // 如果 a <= 0，这行不会执行
  }
  return a - b;
}

// 测试：example(1, 2)
// 覆盖率：2/3 = 66.7%（缺少 else 分支）
```

### 2.2 分支覆盖率

**定义**：执行了多少个分支。

**计算**：`执行的分支数 / 总分支数`

**示例**：
```ts
function example(a: number): string {
  if (a > 0) {
    return 'positive';  // 分支 1
  } else if (a < 0) {
    return 'negative';  // 分支 2
  } else {
    return 'zero';      // 分支 3
  }
}

// 测试：example(1), example(-1)
// 覆盖率：2/3 = 66.7%（缺少 else 分支）
```

### 2.3 函数覆盖率

**定义**：调用了多少个函数。

**计算**：`调用的函数数 / 总函数数`

### 2.4 行覆盖率

**定义**：执行了多少行代码。

**计算**：`执行的行数 / 总行数`

## 3. 覆盖率指标

### 3.1 覆盖率目标

- **语句覆盖率**：80%+
- **分支覆盖率**：80%+
- **函数覆盖率**：80%+
- **行覆盖率**：80%+

### 3.2 关键代码

- **业务逻辑**：100% 覆盖
- **工具函数**：100% 覆盖
- **错误处理**：100% 覆盖
- **边界情况**：100% 覆盖

## 4. 覆盖率分析

### 4.1 未覆盖代码

- **死代码**：永远不会执行的代码
- **错误处理**：未测试的错误路径
- **边界情况**：未测试的边界值
- **条件分支**：未测试的分支

### 4.2 覆盖率盲点

- **异步代码**：异步操作的覆盖率
- **错误路径**：错误处理的覆盖率
- **边界值**：边界条件的覆盖率
- **并发代码**：并发操作的覆盖率

## 5. 最佳实践

### 5.1 覆盖率目标

- 设置合理的目标
- 关键代码 100% 覆盖
- 逐步提高覆盖率
- 关注质量而非数量

### 5.2 覆盖率分析

- 分析未覆盖代码
- 识别测试盲点
- 优化测试策略
- 定期审查覆盖率

## 6. 注意事项

- **质量优先**：覆盖率不是唯一指标
- **合理目标**：设置合理的覆盖率目标
- **关键代码**：优先覆盖关键代码
- **持续改进**：逐步提高覆盖率

## 7. 常见问题

### 7.1 覆盖率多少合适？

通常 80%+ 是合理目标，关键代码应该 100% 覆盖。

### 7.2 如何提高覆盖率？

分析未覆盖代码，添加相应测试。

### 7.3 覆盖率是否越高越好？

不是，应该关注测试质量而非数量。

## 8. 相关资源

- [代码覆盖率](https://en.wikipedia.org/wiki/Code_coverage)
- [覆盖率工具](https://github.com/gotwarlost/istanbul)

---

**下一节**：[7.9.2 Istanbul 与 c8](section-02-tools.md)
