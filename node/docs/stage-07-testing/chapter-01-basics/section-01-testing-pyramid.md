# 7.1.1 测试金字塔

## 1. 概述

测试金字塔是测试策略的经典模型，由 Mike Cohn 提出。测试金字塔描述了不同类型测试的理想比例，帮助团队建立合理的测试策略。

## 2. 测试金字塔结构

### 2.1 三层结构

```
        /\
       /  \      E2E 测试（少量）
      /____\
     /      \    集成测试（中等）
    /________\
   /          \  单元测试（大量）
  /____________\
```

### 2.2 各层特点

- **单元测试（底层）**：数量最多，速度快，成本低
- **集成测试（中层）**：数量中等，速度中等，成本中等
- **E2E 测试（顶层）**：数量最少，速度慢，成本高

## 3. 测试比例

### 3.1 理想比例

- **单元测试**：70%
- **集成测试**：20%
- **E2E 测试**：10%

### 3.2 比例说明

- **单元测试**：覆盖大部分业务逻辑
- **集成测试**：验证组件协作
- **E2E 测试**：验证关键用户流程

## 4. 测试金字塔优势

### 4.1 快速反馈

- 单元测试执行快
- 快速发现问题
- 提高开发效率

### 4.2 成本效益

- 单元测试成本低
- 减少维护成本
- 提高测试覆盖率

### 4.3 稳定性

- 单元测试稳定
- 减少测试失败
- 提高测试可靠性

## 5. 反模式

### 5.1 测试冰激凌

```
        /\
       /  \      E2E 测试（大量）
      /____\
     /      \    集成测试（少量）
    /________\
   /          \  单元测试（很少）
  /____________\
```

**问题**：
- E2E 测试过多
- 执行时间长
- 维护成本高
- 不稳定

### 5.2 测试沙漏

```
        /\
       /  \
      /    \
     /      \
    /        \
   /          \
  /____________\
```

**问题**：
- 缺少集成测试
- 测试覆盖不足
- 难以发现问题

## 6. 实践建议

### 6.1 测试策略

- 优先编写单元测试
- 适量集成测试
- 关键流程 E2E 测试
- 定期审查测试比例

### 6.2 测试优化

- 优化慢速测试
- 并行执行测试
- 使用测试缓存
- 定期重构测试

## 7. 注意事项

- **比例平衡**：保持合理的测试比例
- **测试质量**：注重测试质量而非数量
- **持续优化**：根据项目情况调整策略
- **工具选择**：选择合适的测试工具

## 8. 常见问题

### 8.1 如何确定测试比例？

根据项目特点、团队能力、时间成本确定。

### 8.2 如何处理测试冰激凌？

逐步增加单元测试，减少 E2E 测试。

### 8.3 如何优化测试执行时间？

并行执行、使用缓存、优化慢速测试。

## 9. 相关资源

- [测试金字塔](https://martinfowler.com/articles/practical-test-pyramid.html)
- [测试策略](https://en.wikipedia.org/wiki/Test_strategy)

---

**下一节**：[7.1.2 测试类型（单元、集成、E2E）](section-02-test-types.md)
