# 4.14.3 Insomnia

## 1. 概述

Insomnia 是一个简洁高效的 API 测试工具，提供了快速响应和简洁界面。Insomnia 支持 REST、GraphQL、gRPC 等多种 API 类型，适合个人开发和快速测试。

## 2. 特性说明

- **界面简洁**：简洁直观的界面
- **快速响应**：快速启动和响应
- **插件支持**：支持插件扩展
- **开源免费**：开源且免费使用
- **多协议支持**：支持 REST、GraphQL、gRPC

## 3. 基本使用

### 3.1 创建请求

```
1. 创建新请求
2. 选择 HTTP 方法
3. 输入 URL
4. 配置请求头和请求体
5. 发送请求
```

### 3.2 查看响应

```
响应包含：
- 状态码
- 响应头
- 响应体（支持格式化）
- 响应时间
- 响应大小
```

## 4. 环境变量

### 4.1 创建环境

```
1. 创建新环境
2. 定义环境变量
3. 选择环境
4. 在请求中使用变量
```

### 4.2 使用变量

```http
GET {{base_url}}/api/users
Authorization: Bearer {{auth_token}}
```

## 5. 请求组织

### 5.1 文件夹组织

```
1. 创建文件夹
2. 组织相关请求
3. 使用标签分类
4. 添加描述
```

### 5.2 请求模板

```
1. 创建请求模板
2. 定义模板变量
3. 使用模板创建请求
4. 快速生成请求
```

## 6. 插件系统

### 6.1 安装插件

```
1. 打开插件管理
2. 搜索插件
3. 安装插件
4. 配置插件
```

### 6.2 常用插件

- **GraphQL**：GraphQL 支持
- **gRPC**：gRPC 支持
- **OAuth**：OAuth 认证
- **Response Validation**：响应验证

## 7. 测试脚本

### 7.1 基本测试

```javascript
// 测试响应状态码
const status = response.status;
if (status !== 200) {
  throw new Error(`Expected 200, got ${status}`);
}

// 测试响应体
const body = response.json();
if (!body.users) {
  throw new Error('Response missing users property');
}
```

### 7.2 环境变量设置

```javascript
// 从响应中提取数据
const body = response.json();
insomnia.environment.set('userId', body.user.id);
insomnia.environment.set('token', body.token);
```

## 8. 最佳实践

### 8.1 请求组织

- 使用文件夹组织请求
- 使用标签分类
- 添加描述和注释

### 8.2 环境管理

- 为每个环境创建配置
- 使用环境变量
- 保护敏感信息

### 8.3 测试脚本

- 编写测试脚本验证响应
- 使用环境变量保存数据
- 实现请求链

## 9. 注意事项

- **安全性**：保护 API 密钥和敏感信息
- **版本控制**：使用版本控制管理请求
- **文档化**：文档化 API 和测试用例
- **性能**：注意请求性能

## 10. 常见问题

### 10.1 如何管理多个环境？

为每个环境创建环境配置，使用环境变量管理不同环境的参数。

### 10.2 如何实现请求链？

使用测试脚本从响应中提取数据，设置环境变量，在后续请求中使用。

### 10.3 如何扩展功能？

使用插件系统扩展功能，或使用自定义脚本。

## 11. 实践任务

1. **创建请求集合**：创建 API 请求集合
2. **配置环境**：配置开发、测试、生产环境
3. **编写测试脚本**：编写 API 测试脚本
4. **使用插件**：安装和使用插件
5. **优化工作流**：优化 API 测试工作流

---

**下一章**：[4.15 健康检查](../chapter-15-health/readme.md)
