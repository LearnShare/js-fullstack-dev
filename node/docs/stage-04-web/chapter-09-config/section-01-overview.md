# 4.9.1 配置管理概述

## 1. 概述

配置管理是应用开发中的重要环节，涉及应用运行所需的各种参数和设置。良好的配置管理可以提高应用的可维护性、可扩展性和安全性。

## 2. 核心概念

### 2.1 配置的类型

- **环境配置**：开发、测试、生产等不同环境的配置
- **功能配置**：功能开关、特性标志等
- **安全配置**：密钥、令牌等敏感信息
- **性能配置**：超时、重试、缓存等性能参数

### 2.2 配置的来源

- **环境变量**：通过环境变量传递配置
- **配置文件**：JSON、YAML、TOML 等配置文件
- **命令行参数**：通过命令行传递配置
- **默认值**：配置的默认值

## 3. 配置管理方式

### 3.1 环境变量

```ts
// 直接使用环境变量
const port = process.env.PORT || 3000;
const dbUrl = process.env.DATABASE_URL;
```

### 3.2 配置文件

```ts
// config/default.json
{
  "server": {
    "port": 3000,
    "host": "localhost"
  },
  "database": {
    "url": "postgresql://localhost:5432/mydb"
  }
}
```

### 3.3 配置库

```ts
// 使用配置库
import config from 'config';

const port = config.get<number>('server.port');
const dbUrl = config.get<string>('database.url');
```

## 4. 配置管理原则

### 4.1 分离关注点

- **环境配置**：不同环境使用不同配置
- **敏感信息**：敏感信息使用环境变量
- **默认值**：提供合理的默认值

### 4.2 配置验证

- **类型验证**：验证配置类型
- **必填验证**：验证必填配置
- **格式验证**：验证配置格式

### 4.3 安全性

- **敏感信息**：不在代码中硬编码敏感信息
- **环境变量**：使用环境变量存储敏感信息
- **加密存储**：必要时加密存储敏感配置

## 5. 配置管理工具

### 5.1 node-config

**特点**：
- 支持多环境配置
- 支持配置文件合并
- 支持环境变量覆盖

### 5.2 convict

**特点**：
- 配置验证
- 类型安全
- 默认值支持

### 5.3 dotenv

**特点**：
- 环境变量管理
- .env 文件支持
- 简单易用

## 6. 最佳实践

### 6.1 配置组织

- 按功能模块组织配置
- 使用嵌套结构
- 提供清晰的配置文档

### 6.2 配置验证

- 启动时验证配置
- 提供清晰的错误信息
- 验证所有必填配置

### 6.3 配置安全

- 使用环境变量存储敏感信息
- 不在版本控制中提交敏感配置
- 使用配置加密

## 7. 注意事项

- **安全性**：保护敏感配置信息
- **可维护性**：保持配置清晰和文档化
- **灵活性**：支持不同环境的配置
- **验证**：实现配置验证机制

## 8. 常见问题

### 8.1 如何管理不同环境的配置？

使用配置文件和环境变量，根据 NODE_ENV 加载不同配置。

### 8.2 如何保护敏感配置？

使用环境变量存储敏感信息，不在代码中硬编码。

### 8.3 如何验证配置？

使用配置库的验证功能或自定义验证逻辑。

## 9. 相关资源

- [12-Factor App: Config](https://12factor.net/config)
- [环境变量最佳实践](https://www.twilio.com/blog/environment-variables-in-nodejs)

---

**下一节**：[4.9.2 node-config](section-02-node-config.md)
