# 2.4.5 运算符优先级

## 概述

运算符优先级决定了表达式中运算符的执行顺序。理解运算符优先级对于编写正确的代码至关重要。本节介绍运算符优先级表、结合性和括号的使用。

## 优先级表

### 高优先级到低优先级

1. **成员访问、函数调用**：`.`、`[]`、`()`
2. **new（带参数列表）**：`new Class()`
3. **后置自增自减**：`++`、`--`
4. **逻辑非、按位非、一元加、一元减**：`!`、`~`、`+`、`-`
5. **前置自增自减**：`++`、`--`
6. **typeof、void、delete**：`typeof`、`void`、`delete`
7. **指数**：`**`
8. **乘法、除法、取余**：`*`、`/`、`%`
9. **加法、减法**：`+`、`-`
10. **按位左移、右移**：`<<`、`>>`、`>>>`
11. **关系运算符**：`<`、`<=`、`>`、`>=`、`in`、`instanceof`
12. **相等运算符**：`==`、`!=`、`===`、`!==`
13. **按位与**：`&`
14. **按位异或**：`^`
15. **按位或**：`|`
16. **逻辑与**：`&&`
17. **逻辑或**：`||`
18. **空值合并**：`??`
19. **三元运算符**：`? :`
20. **赋值运算符**：`=`、`+=`、`-=`、`*=`、`/=`、`%=`、`**=`
21. **yield**：`yield`、`yield*`
22. **逗号**：`,`

## 结合性

### 左结合

大多数运算符是左结合的，从左到右执行：

```js
// 左结合
10 - 5 - 2;        // (10 - 5) - 2 = 3
10 / 5 / 2;        // (10 / 5) / 2 = 1
```

### 右结合

某些运算符是右结合的，从右到左执行：

```js
// 右结合
let x = y = 10;     // y = 10, x = 10
2 ** 3 ** 2;        // 2 ** (3 ** 2) = 512
```

## 常见优先级问题

### 问题 1：算术运算符

```js
// 乘除优先级高于加减
10 + 5 * 2;        // 20（不是 30）
10 - 5 / 2;        // 7.5（不是 2.5）

// 使用括号明确优先级
(10 + 5) * 2;      // 30
10 - (5 / 2);      // 7.5
```

### 问题 2：逻辑运算符

```js
// && 优先级高于 ||
true || false && false;  // true（等价于 true || (false && false)）

// 使用括号明确优先级
(true || false) && false; // false
```

### 问题 3：赋值运算符

```js
// 赋值运算符优先级很低
let x = 10;
let y = x + 5;     // y = 15（不是 x = 15, y = 15）

// 链式赋值
let a = b = 10;    // b = 10, a = 10（右结合）
```

### 问题 4：比较运算符

```js
// 比较运算符优先级低于算术运算符
10 + 5 > 10;       // true（等价于 (10 + 5) > 10）

// 使用括号明确优先级
10 + (5 > 10);     // 10 + false = 10
```

## 使用括号

### 明确优先级

```js
// 使用括号明确优先级
let result = (10 + 5) * 2;        // 30
let condition = (x > 0) && (y < 10);
let value = (a ?? b) && (c || d);
```

### 提高可读性

```js
// 即使优先级正确，使用括号提高可读性
let result = (x + y) * (a - b);
let condition = (user && user.isAdmin) || (guest && guest.hasPermission);
```

## 最佳实践

### 1. 使用括号明确优先级

```js
// 好的做法：使用括号
let result = (a + b) * (c - d);
let condition = (x > 0) && (y < 10);

// 避免：依赖优先级
let result2 = a + b * c - d; // 可能不是期望的结果
```

### 2. 复杂表达式拆分

```js
// 好的做法：拆分复杂表达式
let sum = a + b;
let product = c * d;
let result = sum - product;

// 避免：一行写太多
let result2 = a + b - c * d;
```

### 3. 理解常用优先级

```js
// 记住常用优先级
// 1. 成员访问和函数调用
obj.property();
arr[0];

// 2. 算术运算符：** > * / % > + -
2 ** 3 * 4;        // (2 ** 3) * 4 = 32

// 3. 比较运算符：< > <= >= > == ===
10 + 5 > 10;       // (10 + 5) > 10 = true

// 4. 逻辑运算符：&& > ||
true || false && false; // true || (false && false) = true
```

## 练习

1. **优先级计算**：编写包含多个运算符的表达式，不使用括号，预测计算结果。

2. **使用括号**：将复杂的表达式使用括号明确优先级，提高可读性。

3. **结合性**：演示左结合和右结合的区别，理解运算符的结合性。

4. **常见陷阱**：找出容易出错的优先级陷阱，使用括号避免错误。

5. **表达式拆分**：将复杂的表达式拆分为多个简单的表达式，提高可读性。

完成以上练习后，继续学习下一章：控制结构。

## 总结

运算符优先级是 JavaScript 中的重要概念。主要要点：

- 理解运算符优先级表
- 理解左结合和右结合
- 使用括号明确优先级
- 复杂表达式拆分提高可读性
- 记住常用优先级规则

完成本章学习后，继续学习下一章：控制结构。
